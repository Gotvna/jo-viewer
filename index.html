<html class="scroll-smooth">
<head>
  <title>JO 2026</title>
  <meta charset="utf-8">
  <meta name="description" content="Suivez en direct le planning des compétitions des Jeux Olympiques et Paralympiques d’hiver !">
  <link rel="icon" href="https://gstatic.olympics.com/s3/mc2026/favicon/favicon-194x194.png">
  <meta name="viewport" content="width=device-width,initial-scale=0.8">
  <style>
    [x-cloak] { display: none !important; }
    .app .alert-end {
      pointer-events: none;
    }
    .app:has(article.is-flashing) .alert-end {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body class="bg-black text-white">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/alpinejs" defer></script>

<div x-data="app" x-init="init()" x-on:scrollend.document.debounce.250ms="scrollEnd()" @keyup.shift.A.window="goToFinished()" @keyup.shift.C.window="goToTime()" @keyup.enter.window="enter" class="app flex flex-col gap-2 p-2">
  <div class="text-center p-2 text-sm select-none flex gap-2 justify-between items-center">
    <div class="font-bold">JO 2026</div>
    <div>Planning du <span x-text="currentDate"></span></div>
    <button @click.prevent="toggleAboutModal()" class="text-sm px-2 py-1 bg-neutral-700 rounded">À propos</button>
  </div>
  <div @click="goToFinished()" class="alert-end fixed z-10 top-0 left-0 w-full p-3 text-center text-sm italic bg-red-500 opacity-0 transition-all cursor-pointer select-none animate-bounce hover:animate-none">!! Alerte fin d'épreuve !!</div>
  <template x-for="event in events">
    <article x-bind:data-id="event.id" class="relative group w-full p-2 pt-1 border-t-4 border-t-transparent" :class="{ 'odd:bg-gray-900 even:bg-gray-900/80': event.medalFlag == 0, 'bg-gray-700': event.medalFlag >= 1, '!border-t-red-500': event.topBorder, 'is-highlight': event.topBorder, 'is-flashing': isHighlight(event) }">
      <div class="absolute z-1 top-0 left-0 right-0 bottom-0" :class="{ 'bg-red-600 animate-pulse group-hover:bg-red-600/60 transition-all group-hover:animate-none': isHighlight(event) }"></div>
      <div class="relative z-2 select-none flex items-center justify-between">
        <div class="flex pl-8 flex-auto items-center cursor-pointer gap-5 justify-between" @click="if(event.competitors.length > 0) competitorsExpandToggle(event)"
             x-on:contextmenu="$event.preventDefault();setTopBorder(event)">
          <span class="grow-0 text-white/60" x-text="event.startAt"></span>
          <div class="grow truncate">
            <div class="font-bold text-sm truncate" x-text="event.sportName"></div>
            <div class="text-sm truncate" x-text="event.eventName"></div>   
          </div>
          <div class="grow-0 flex gap-2 items-center">
          <img x-show="event.hasFR" class="inline-block w-5 select-none" src="https://gstatic.olympics.com/s1/t_original/static/noc/oly/3x2/180x120/FRA.png" />
          <a @click.stop x-show="event.competitors.length > 0" x-bind:href="event.detailUrl" x-bind:target="'_blank'" class="opacity-50 select-none">></a>  
          </div>
        </div>
        <div class="grow-0 absolute left-1 w-4">
           <div x-show="event.status == 'RUNNING'" title="En cours" class="w-4 h-4 rounded-full bg-red-500 animate-pulse"></div>
           <div x-show="event.status == 'RESCHEDULED'" title="Reprogrammé" class="w-4 h-4 rounded-full bg-black"></div>
           <div x-show="event.status == 'SCHEDULED_BREAK'" title="En Pause" class="w-4 h-4 rounded-full bg-transparent border-[3px] border-orange-500"></div>
           <div x-show="event.status == 'FINISHED'" title="Terminé" class="w-4 h-4 rounded-full bg-transparent border-[3px] border-green-500"></div>     
           <div x-show="event.status == 'FINISHED_MEDALS'" title="Terminé" class="w-4 h-4 rounded-full bg-green-500"></div>     
        </div>
      </div>
      <div class="relative z-2 max-w-5xl mx-auto mt-2" x-show="event.competitorsExpanded">
        <div x-show="event.competitors.length === 0" class="opacity-50 select-none text-center text-sm">Pas d'informations supplémentaires</div>
        <ul>
          <template x-for="c,i in event.competitors">
            <li class="hover:bg-black/30 p-1 px-2 transition-colors">
              <div x-show="c.code === 'TBD' || c.code === ''" class="flex justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-5"></div>
                  <div class="w-6 text-right opacity-80" x-text="`${i + 1}`"></div>
                  <span class="cursor-pointer select-none italic text-sm opacity-40">Non déterminé pour l'instant</span>
                </div>
              </div>
              <div x-show="c.code !== 'TBD' && c.code !== ''" class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                  <div class="w-5 select-none">
                    <div x-show="c.results?.medalType == 'ME_GOLD'" class="inline-block text-center w-5 h-5 bg-yellow-300 text-black text-sm font-bold rounded-full">O</div>
                    <div x-show="c.results?.medalType == 'ME_SILVER'" class="inline-block text-center w-5 h-5 bg-gray-300 text-black text-sm font-bold rounded-full">A</div>
                    <div x-show="c.results?.medalType == 'ME_BRONZE'" class="inline-block text-center w-5 h-5 bg-yellow-700 text-black text-sm font-bold rounded-full">B</div>
                  </div>
                  <div class="w-6 text-right opacity-80" x-text="`${i + 1}`"></div>
                  <img class="inline-block w-5 select-none" :src="`https://gstatic.olympics.com/s1/t_original/static/noc/oly/3x2/180x120/${c.noc}.png`" />
                  <div class="w-7 text-center select-none opacity-70 cursor-default text-sm" x-text="c.noc" x-bind:title="getNocLabel(c.noc)"></div>
                  <span x-text="c.name" class="cursor-pointer select-all" @click="copyName(c.name)" :class="{'font-bold': c.results?.winnerLoserTie == 'W'}"></span>
                  <div x-show="c.results?.winnerLoserTie == 'W'" class="inline-block select-none font-bold">(W)</div>

                </div>
                <div class="flex gap-2 items-center select-none">
                  <div x-show="c.results?.irm" x-text="c.results?.irm" class="text-sm select-none italic opacity-50"></div>
                  <div x-show="c.results?.mark" x-text="c.results?.mark" class="text-sm"></div>
                  <div x-show="c.results?.additionalMark" x-text="c.results?.additionalMark" class="text-xs"></div>
                </div>
              </div>
            </li>
          </template>
        </ul>
      </div>
    </article>
  </template>
  <div x-show="aboutModal" @click.prevent="toggleAboutModal()" x-cloak class="bg-neutral-900/50 backdrop-blur fixed top-0 left-0 bottom-0 right-0 w-full h-dvh flex justify-center select-none overflow-scroll p-4">
    <div class="max-h-[90vh] ">
      <div class="flex flex-col gap-2 bg-neutral-800 p-4 rounded-lg">
        <div class="font-bold text-lg text-center">JO Viewer</div>
        <div>Cet outil permet de visualiser rapidement, en temps réel et sans rafraichissement de la page, le planning du jour des Jeux Olympiques et Paralympiques.</div>
        <div class="font-bold">Il n'est pas géré par le Comité International Olympique.</div>
        <div>Ce projet est Open-Source !<br/>Vous pouvez y contribuer ici :<br/><a @click.stop="" href="https://github.com/boherm/jo-viewer" target="_blank" class="underline">https://github.com/boherm/jo-viewer</a>.</div>
        <div><br/></div>
        <div class="font-bold">Astuces :</div>
        <div>- Avec < Shift + C > vous pouvez scroller automatiquement vers les compétitions en cours.</div>
        <div>- En faisant un clic droit sur une compétition, vous serez notifié quand celle-ci sera terminée.</div>
        <div>- Les finales sont affichées avec une couleur plus claire dans la liste.</div>
        <div><br/></div>
        <div class="text-center"><button class="rounded text-lg px-4 py-1 font-bold bg-green-800">D'accord !</button></div>
      </div>
    </div>
  </div>
  <div class="p-2 text-neutral-400 text-center text-xs">by <a href="https://github.com/boherm" target="_blank" class="underline font-bold">boherm</a> - version 2.0.1</div>
</div>

<script>
  const dateMin = new Date("2026-02-04");
  const dateMax = new Date("2026-02-22");
  const today = new Date() < dateMin ? dateMin : new Date() > dateMax ? dateMax : new Date();
  
  const dateAPI = today.getFullYear().toString() + '-' + (today.getMonth() + 1).toString().padStart(2, 0) + '-' + today.getDate().toString().padStart(2, 0);
  const urlAPI = `https://www.olympics.com/wmr-owg2026/schedules/api/FRA/schedule/day/${dateAPI}`;
  const nocsUrlAPI = `https://www.olympics.com/wmr-owg2026/info/api/FRA/nocs`;
  
  document.addEventListener('alpine:init', () => {
      Alpine.data('app', () => ({
        events: [],
        nocs: [],
        firstLoad: true,
        tick: 0,
        scrollendTimeout: null,
        currentDate: `${today.getDate().toString().padStart(2, 0)}/${(today.getMonth() + 1).toString().padStart(2, 0)}/${today.getFullYear().toString()}`,
        aboutModal: false,

        init() {
          this.loadNocs();
          this.loadData();

          setInterval(() => {
            this.loadData();
          }, 2000);

          this.aboutModal = true;
          if (window.localStorage.getItem("aboutModal"))
            this.aboutModal = window.localStorage.getItem("aboutModal") !== "false";
        },

        toggleAboutModal() {
          this.aboutModal = !this.aboutModal;
          window.localStorage.setItem("aboutModal", false);
        },

        scrollEnd() {

          if (this.scrollendTimeout) {
            clearTimeout(this.scrollendTimeout);
          }
          
          this.scrollendTimeout = setTimeout(() => {
            const $events = document.querySelectorAll(`article`);
            $events.forEach(el => {
              if (el.classList.contains('!bg-yellow-800')) {
                el.classList.remove("!bg-yellow-800");
              }
            });
            this.scrollendTimeout = null;
          }, 250);
        },

        setTopBorder(event) {
          let topBorderSaved = JSON.parse(window.localStorage.getItem("topBorder")) || [];

          if (event.topBorder) {
            event.topBorder = false;
            topBorderSaved = topBorderSaved.filter(t => t !== event.id);

          } else {
            event.topBorder = true;
            topBorderSaved.push(event.id);
          }

          window.localStorage.setItem("topBorder", JSON.stringify(topBorderSaved));
        },

        isHighlight(event) {
          return event.topBorder && ((event.medalFlag && event.status === "FINISHED_MEDALS") || (!event.medalFlag && event.status === "FINISHED"));
        },

        goToFinished() {
          window.scrollTo(0, (document.querySelector('.is-flashing')?.getBoundingClientRect()?.top + window.scrollY) - 50);
        },

        enter(e) {
          if (e.shiftKey) {
            this.reverseScroll();
          } else {
            this.scroll();
          }
        },

        scroll() {
          const highlights = document.querySelectorAll('.is-highlight');
          const currentScrollY = window.scrollY;

          let nextScrollY = 0;

          for ( let i = 0 ; i < highlights.length ; i++) {
            const posY = highlights[i].getBoundingClientRect()?.top + currentScrollY;

            if (currentScrollY < posY) {
              highlights[i].classList.add("!bg-yellow-800");
              nextScrollY = posY;
              break;
            }
          }

          if (nextScrollY === 0) {
            for ( let i = 0 ; i < highlights.length ; i++) {
              const posY = highlights[i].getBoundingClientRect()?.top + currentScrollY;

              if (currentScrollY < posY) {
                highlights[i].classList.add("!bg-yellow-800");
                nextScrollY = posY;
                break;
              }
            }
          }

          window.scrollTo(0, nextScrollY);
        },

        goToTime() {
          const currentTime = new Date();
          const currentHours = currentTime.getHours();
          const currentMinutes = currentTime.getMinutes();

          let lastId = null;

          for ( let i = 0 ; i < this.events.length ; i++) {
            const time = this.events[i].startAt.split(':').map(d => parseFloat(d));
            if (time[0] > currentHours || time[0] == currentHours && time[1] > currentMinutes) {
              break;
            }
            lastId = this.events[i].id;
          }

          if (lastId) {
            const $event = document.querySelector(`article[data-id="${lastId}"]`);
            $event.classList.add("!bg-yellow-800");
            const nextScrollY = $event?.getBoundingClientRect()?.top + window.scrollY - (window.innerHeight / 2) + 56;

            if (nextScrollY === window.scrollY) {
              setTimeout(() => {
                $event.classList.remove("!bg-yellow-800");
              }, 250);
            }

            window.scrollTo(0, nextScrollY);
          }
        },

        reverseScroll() {
          const highlights = document.querySelectorAll('.is-highlight');
          const currentScrollY = window.scrollY;

          let nextScrollY = 0;
          let nextEvent = null;

          for ( let i = 0 ; i < highlights.length ; i++) {
            const posY = highlights[i].getBoundingClientRect()?.top + currentScrollY;

            if (currentScrollY > posY) {
              nextScrollY = posY;
              nextEvent = highlights[i];
            } else {
              break;
            }
          }

          if (nextScrollY === 0) {
            for ( let i = 0 ; i < highlights.length ; i++) {
              const posY = highlights[i].getBoundingClientRect()?.top + currentScrollY;

              if (currentScrollY > posY) {
                nextEvent = highlights[i];
                nextScrollY = posY;
              } else {
                break;
              }
            }
          }

          nextEvent?.classList.add("!bg-yellow-800");

          window.scrollTo(0, nextScrollY);
        },

        competitorsExpandToggle(event) {
          event.competitorsExpanded = !event.competitorsExpanded;
          let expanded = JSON.parse(window.localStorage.getItem("competitorsExpanded")) || [];

          if (event.competitorsExpanded) {
            expanded.push(event.id);          
          } else {
            expanded = expanded.filter(e => e !== event.id);
          }

          window.localStorage.setItem("competitorsExpanded", JSON.stringify(expanded));
        },

        async loadNocs() {
          const api = await (await fetch(nocsUrlAPI)).json();
          api.nocs.forEach((data) => {
            this.nocs.push({
              'code': data.id,
              'description': data.longName
            });
          });
        },

        getNocLabel(noc) {
          return this.nocs.find(d => d.code == noc)?.description;
        },

        copyName(name) {
            let firstname = "";
            let lastname = "";

            const parts = name.split(/[\s]+/);

            parts.forEach(p => {
              const regFirst = p.match(/^([A-Z]{1})[^A-Z]+/);
              const regMid = p.match(/^([a-z]*)$/);
              const regLast = p.match(/^([A-Zc\W]*)$/);

              if (regFirst && regFirst[1]) {
                if (firstname !== "") firstname += " ";
                firstname += regFirst[1] + '.';
              } else if (regMid && regMid[1]) {
                if (firstname !== "") firstname += " ";
                firstname += regMid[1];
              }

              if (regLast && regLast[1]) {
                if (lastname !== "") lastname += " ";

                const tmp = regLast[1].split('-');
                lastname += tmp.map(d => {
                  if (d[0] === 'M' && d[1] === 'c' && d[2]) {
                    firstname = firstname.slice(0, -3);
                    return "Mc" + d[2] + d.slice(3).toLowerCase();
                  } else if (d[0] === 'O' && d[1] === '\'' && d[2]) {
                    firstname = firstname.slice(0, -3);
                    return "O'" + d[2] + d.slice(3).toLowerCase();
                  }
                  return d[0] + d.slice(1).toLowerCase();
                }).join('-');
              }
            });

            let out = firstname + " " + lastname;
            navigator.clipboard.writeText(out);
        },

        async loadData() {
          const api = await (await fetch(urlAPI)).json();
          const topBorderSaved = JSON.parse(window.localStorage.getItem("topBorder")) || [];
          const expandedSaved = JSON.parse(window.localStorage.getItem("competitorsExpanded")) || [];

          api.units.forEach((data) => {

            const event = this.events.findIndex(e => e.id == data.id);
            const competitors = data.competitors ?? [];

            const hasMedals = competitors.filter(c => ['ME_GOLD', 'ME_SILVER', 'ME_BRONZE'].includes(c.results?.medalType)).length > 0;

            const eventData = {
              'id': data.id,
              'topBorder': topBorderSaved.includes(data.id),
              'sportName': data.disciplineName,
              'eventName': data.eventUnitName,
              'startAt': new Date(data.startDate).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }),
              'medalFlag': data.medalFlag > 0,
              'status': hasMedals ? 'FINISHED_MEDALS' : data.status,
              'competitors': competitors,
              'competitorsExpanded': expandedSaved.includes(data.id),
              'detailUrl': `https://olympics.com${data.extraData?.detailUrl ?? ''}`,
              'hasFR': competitors.findIndex(c => c.noc === 'FRA') !== -1,
            };

            if (event === -1) {
              this.events.push(eventData);            
            } else {
              const idx = this.events.findIndex(e => e.id == data.id);
              eventData.competitorsExpanded = this.events[idx].competitorsExpanded;
              eventData.topBorder = this.events[idx].topBorder;

              this.events[idx] = {
                ...eventData,
              }
            }

          });
        }
      }))
    })
</script>
</body>
</html>